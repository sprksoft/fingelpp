{{define "title"}}{{ if .Edit }}Edit{{ end }} {{ .Lesson.Name }} - Fingel++ {{end}}
{{ define "head" }} <link
  rel="stylesheet"
  type="text/css"
  href="https://unpkg.com/tiny-markdown-editor/dist/tiny-mde.min.css"
/>
{{ end }}
{{ define "content" }}
<nav>
  <a href="/#chapter-{{ .ChapterId }}">{{ .ChapterName }}</a> <span>&gt;</span> <a href="/#lesson-{{ .Lesson.Id }}">{{ .Lesson.Name }}<span id="unsaved-icon">*</span></a>

  {{ if .Edit }}
  <button onclick="fetch('/lessons/{{ .Lesson.Id }}/reload', { method: 'POST' }).then(()=>{location.reload()})">Reload</button>
  <button
    class="right-nav-button"
    onclick="fetch('/lessons/{{ .Lesson.Id }}/delete', {method: 'DELETE'}, ).then(()=>{location.replace('/')})"
  >
    Delete
  </button>
  <button class="right-nav-button" onclick="saveLesson()">Save</button>
  {{ end }}
</nav>
<main>
  {{ if .Edit }}
  <div id="lessonEditor">
  <div id="LessonToolbar"></div>
    <div id="LessonSrcCode" spellcheck="false"></div>
  </div>
  {{ end }}
  <div id="lesson">
    <h1 class="lesson-name">{{ .Lesson.Name }}</h1>
    <div id="lessonContent">
    {{ .Lesson.Content }}
    </div>
  </div>
</main>

{{ end }}
{{ define "scripts" }}
<script>
    const LESSON_ID="{{ .Lesson.Id }}"
</script>
{{ if .Edit }}
<script>const ORIGINAL_SOURCE = "{{ .Lesson.Src }}"</script>
<script src="https://unpkg.com/tiny-markdown-editor/dist/tiny-mde.min.js"></script>
<script src="/static/js/editor.js"></script>
<script>
  (async ()=> {
      document
      .getElementById("LessonSrcCode")
      .addEventListener("change", updateLessonPreview);
  })();
</script>
{{ end }}
<script>
    localStorage.setItem("lastOpenedLesson", "{{ .Lesson.Id }}");
</script>
{{ end }}
